# R for travis: see documentation at https://docs.travis-ci.com/user/languages/r

language: r
sudo: false
cache: packages
latex: false
pandoc_version: 1.19.2.1

r:
  - 3.5.1

repos:
  CRAN: https://mran.microsoft.com/snapshot/2018-11-09

install:
  - Rscript scripts/install.R

script:
  - Rscript scripts/cranlogs.R data/cranlogs.txt
  - Rscript scripts/github-views.R data/github-views.txt
  - Rscript scripts/github-clones.R data/github-clones.txt
  - Rscript -e 'rmarkdown::render("readme.Rmd")'

branches:
  only:
    - master

# Commit updates to data files
after_success: |
  if [ -n "$GITHUB_PAT" ]; then
    git config user.name "Travis CI"
    git config user.email "Travis CI"
    git checkout -q master
    git add data/ README.md
    git commit --allow-empty -m "Update data [skip ci]"
    git push --quiet https://workflowr:$GITHUB_PAT@github.com/workflowr/workflowr-metrics.git master &>/dev/null
  fi
